{"version":3,"file":"Selectbox.test.js","names":["React","fireEvent","screen","render","WidgetStateManager","Selectbox","SelectboxProto","mockTheme","jsx","_jsx","getProps","elementProps","arguments","length","undefined","widgetProps","element","create","id","label","default","options","width","disabled","theme","emotion","widgetMgr","sendRerunBackMsg","jest","fn","formsDataChanged","pickOption","selectbox","value","click","valueElement","getByText","describe","it","props","expect","getByTestId","toBeInTheDocument","spyOn","setIntValue","toHaveBeenCalledWith","fromUi","fragmentId","getByRole","toHaveBeenLastCalledWith","queryByText","not","formId","setFormClearOnSubmit","submitForm"],"sources":["../../../../src/components/widgets/Selectbox/Selectbox.test.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022-2024)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\"\n\nimport \"@testing-library/jest-dom\"\nimport { fireEvent, screen } from \"@testing-library/react\"\n\nimport { render } from \"@streamlit/lib/src/test_util\"\nimport { WidgetStateManager } from \"@streamlit/lib/src/WidgetStateManager\"\nimport { Selectbox as SelectboxProto } from \"@streamlit/lib/src/proto\"\nimport { mockTheme } from \"@streamlit/lib/src/mocks/mockTheme\"\n\nimport { Props, Selectbox } from \"./Selectbox\"\n\nconst getProps = (\n  elementProps: Partial<SelectboxProto> = {},\n  widgetProps: Partial<Props> = {}\n): Props => ({\n  element: SelectboxProto.create({\n    id: \"1\",\n    label: \"Label\",\n    default: 0,\n    options: [\"a\", \"b\", \"c\"],\n    ...elementProps,\n  }),\n  width: 0,\n  disabled: false,\n  theme: mockTheme.emotion,\n  widgetMgr: new WidgetStateManager({\n    sendRerunBackMsg: jest.fn(),\n    formsDataChanged: jest.fn(),\n  }),\n  ...widgetProps,\n})\n\nconst pickOption = (selectbox: HTMLElement, value: string): void => {\n  fireEvent.click(selectbox)\n  const valueElement = screen.getByText(value)\n  fireEvent.click(valueElement)\n}\n\ndescribe(\"Selectbox widget\", () => {\n  it(\"renders without crashing\", () => {\n    const props = getProps()\n    render(<Selectbox {...props} />)\n    expect(screen.getByTestId(\"stSelectbox\")).toBeInTheDocument()\n  })\n\n  it(\"sets widget value on mount\", () => {\n    const props = getProps()\n    jest.spyOn(props.widgetMgr, \"setIntValue\")\n\n    render(<Selectbox {...props} />)\n    expect(props.widgetMgr.setIntValue).toHaveBeenCalledWith(\n      props.element,\n      props.element.default,\n      { fromUi: false },\n      undefined\n    )\n  })\n\n  it(\"can pass fragmentId to setIntValue\", () => {\n    const props = getProps(undefined, { fragmentId: \"myFragmentId\" })\n    jest.spyOn(props.widgetMgr, \"setIntValue\")\n\n    render(<Selectbox {...props} />)\n    expect(props.widgetMgr.setIntValue).toHaveBeenCalledWith(\n      props.element,\n      props.element.default,\n      { fromUi: false },\n      \"myFragmentId\"\n    )\n  })\n\n  it(\"handles the onChange event\", () => {\n    const props = getProps()\n    jest.spyOn(props.widgetMgr, \"setIntValue\")\n\n    render(<Selectbox {...props} />)\n\n    const selectbox = screen.getByRole(\"combobox\")\n    pickOption(selectbox, \"b\")\n\n    expect(props.widgetMgr.setIntValue).toHaveBeenLastCalledWith(\n      props.element,\n      1,\n      { fromUi: true },\n      undefined\n    )\n    expect(screen.queryByText(\"a\")).not.toBeInTheDocument()\n    expect(screen.getByText(\"b\")).toBeInTheDocument()\n  })\n\n  it(\"resets its value when form is cleared\", () => {\n    // Create a widget in a clearOnSubmit form\n    const props = getProps({ formId: \"form\" })\n    props.widgetMgr.setFormClearOnSubmit(\"form\", true)\n\n    jest.spyOn(props.widgetMgr, \"setIntValue\")\n\n    render(<Selectbox {...props} />)\n\n    const selectbox = screen.getByRole(\"combobox\")\n    pickOption(selectbox, \"b\")\n\n    expect(props.widgetMgr.setIntValue).toHaveBeenLastCalledWith(\n      props.element,\n      1,\n      { fromUi: true },\n      undefined\n    )\n\n    // \"Submit\" the form\n    props.widgetMgr.submitForm(\"form\", undefined)\n\n    // Our widget should be reset, and the widgetMgr should be updated\n    expect(screen.getByText(\"a\")).toBeInTheDocument()\n    expect(screen.queryByText(\"b\")).not.toBeInTheDocument()\n    expect(props.widgetMgr.setIntValue).toHaveBeenLastCalledWith(\n      props.element,\n      props.element.default,\n      {\n        fromUi: true,\n      },\n      undefined\n    )\n  })\n})\n"],"mappings":"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"}